<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trendleri</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <style>
        body {
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            background: url('pic.png') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            padding: 20px;
        }

        .back-button {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            color: #fff;
            background: #005ea8;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            font-size: 18px;
            /* Increase font size */
            margin-bottom: 20px;
            /* Add margin to separate the button from the chart box */
        }

        .back-button:hover {
            background: #003f74;
        }

        .back-button .material-icons {
            vertical-align: middle;
            margin-right: 5px;
        }

        .go-to-situation-button {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            color: #fff;
            background: #005ea8;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            font-size: 18px;
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .go-to-situation-button:hover {
            background: #003f74;
        }

        .go-to-situation-button .material-icons {
            vertical-align: middle;
            margin-left: 5px;
        }

        .trend-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: stretch;
            /* Ensure all items are the same height */
            max-width: 100%;
            margin-left: 0 auto;
            /* Center align horizontally */
        }

        .trend-section {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            /* Ensure content is spaced evenly */
        }

        .trend-section h2 {
            color: #005ea8;
        }

        .chart-container {
            display: flex;
            flex-wrap: wrap;
            /* Allow items to wrap to the next line when space is filled */
            gap: 20px;
            /* Add space between each chart box */
            justify-content: flex-start;
            /* Align items from the start */
            width: 100%;
            margin-top: 20px;
            padding: 1 20px;
        }

        .chart-box {
            flex: 1 1 45%;
            /* Allow each box to take 45% of the container width */
            min-width: 100px;
            /* Prevent the box from getting too small */
            max-width: 410px;
            /* Prevent the box from becoming too large */
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }


        .chart-info {
            margin-top: 15px;
            font-size: 20px;
            color: #333;
            white-space: normal;
            /* Allow text to wrap */
            word-wrap: break-word;
            /* Break words if they are too long */
            word-break: break-word;
            /* Ensures long words break properly */
            overflow-wrap: break-word;
            /* Allow text to break and wrap correctly */
        }
    </style>
</head>

<body>
    <a href="dashboard.html" class="back-button">
        <span class="material-icons">arrow_back</span>
        <span>Dashboard</span>
    </a>
    <a href="situation.html" class="go-to-situation-button">
        Durum
        <span class="material-icons">arrow_forward</span>
    </a>

    <div class="trend-container">
        <div class="trend-section">
            <h2 style="font-size: 24px;">1. Küresel Otomotiv Pazarı Trendleri</h2>
            <p style="font-size: 24px;"><strong>Elektrikli Araçların (EV) Benimsenmesi:</strong> Küresel otomotiv pazarında elektrikli araçlara doğru önemli bir kayma yaşanıyor.</p>
        </div>
        <div class="trend-section">
            <h2 style="font-size: 24px;">2. Rekabet Ortamı</h2>
            <p style="font-size: 24px;"><strong>Japon Üreticiler Birleşmesi:</strong> Honda ve Nissan, birleşerek dünyanın en büyük üçüncü otomobil grubu olmayı hedefliyor.</p>
        </div>
        <div class="trend-section">
            <h2 style="font-size: 24px;">3. Pazar Zorlukları ve Fırsatlar</h2>
            <p style="font-size: 24px;"><strong>Tüketici Tercihleri:</strong> Kompakt otomobillere doğru artan bir tüketici kayması var ve elektrikli araçlar, satın alınabilirlik kaygıları ve çevresel kaygılar tarafından yönlendirilmektedir.</p>
        </div>
    </div>
    <div class="chart-container">
        <div class="chart-box">
            <canvas id="doughnutChart" width="700" height="450"></canvas>
        </div>
        <div class="chart-box">
            <select id="nameDropdown" title="Select a Name" onchange="fetchAndRenderChart()">
                <option value="">--Bir model seçiniz--</option>
            </select>
            <canvas id="linearChart" width="700" height="450"></canvas>
            <div class="chart-info">
                <p>Elektrikli olmayan otomobillerin satış eğilimlerini göstermektedir.</p>
            </div>
        </div>
        <div class="chart-box">
            <select id="nameDropdown1" title="Select a model" onchange="fetchAndRenderChart1()">
                <option value="">--Bir model seçiniz--</option>
            </select>
            <canvas id="linearChart1" width="700" height="450"></canvas>
            <div class="chart-info">
                <p>Elektrikli olan otomobillerin satış eğilimlerini göstermektedir.</p>
            </div>
        </div>
        <div class="chart-box">
            <h3 style="text-align: center; color: #005ea8; margin-bottom: 20px; font-size: 22px;">En iyi 5 Performans gösteren elektrikli olmayan Modeller</h3>
            <ul style="list-style: none; padding: 0; margin: 0; font-size: 20px; line-height: 1.8;">
                <li style="margin-bottom: 12px;"><strong>Tiguan:</strong> 3,501,541</li>
                <li style="margin-bottom: 12px;"><strong>Polo/Virtus/Nivus/Taigo:</strong> 2,666,007</li>
                <li style="margin-bottom: 12px;"><strong>Passat/Magotan:</strong> 2,346,827</li>
                <li style="margin-bottom: 12px;"><strong>Lavida:</strong> 1,973,722</li>
                <li style="margin-bottom: 12px;"><strong>Golf:</strong> 1,964,735</li>
            </ul>
        </div>

        <div class="chart-box">
            <h3 style="text-align: center; color: #005ea8; margin-bottom: 20px; font-size: 22px;">Alt 5 Elektrikli Olmayan Modellerin Performansı</h3>
            <ul style="list-style: none; padding: 0; margin: 0; font-size: 20px; line-height: 1.8;">
                <li style="margin-bottom: 12px;"><strong>Beetle:</strong> 20,580</li>
                <li style="margin-bottom: 12px;"><strong>Phideon:</strong> 38,223</li>
                <li style="margin-bottom: 12px;"><strong>Fox/Suran:</strong> 74,621</li>
                <li style="margin-bottom: 12px;"><strong>Sharan/Viloran:</strong> 120,614</li>
                <li style="margin-bottom: 12px;"><strong>Touareg:</strong> 194,783</li>
            </ul>
        </div>

        <div class="chart-box">
            <h3 style="text-align: center; color: #005ea8; margin-bottom: 20px; font-size: 22px;">Almanya'da elektrikli otomobil fabrikası</h3>
            <ul style="list-style: none; padding: 0; margin: 0; font-size: 20px; line-height: 1.8;">
                <li style="margin-bottom: 38px;"><strong>Wolfsburg</strong></li>
                <li style="margin-bottom: 38px;"><strong>Zwickau</strong></li>
                <li style="margin-bottom: 38px;"><strong>Emden</strong></li>
            </ul>
        </div>    

    </div>

    <script>
        let currentChart = null; // Variable to store the current chart instance

        async function populateDropdown() {
            const response = await fetch('/getNames');
            const names = await response.json();
            const dropdown = document.getElementById('nameDropdown');

            names.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                dropdown.appendChild(option);
            });
        }

        async function fetchAndRenderChart() {
            const selectedName = document.getElementById('nameDropdown').value;
            if (!selectedName) return;

            const response = await fetch(`/getSalesData?name=${encodeURIComponent(selectedName)}`);
            const salesData = await response.json();

            // Initialize a year range (2019 to 2023)
            const yearsRange = [2019, 2020, 2021, 2022, 2023];

            // Prepare an object to store sales data by year
            const salesByYear = {};
            yearsRange.forEach(year => {
                salesByYear[year] = 0; // Initialize with 0 for each year
            });

            // Fill the salesByYear object with the actual sales data
            salesData.forEach(data => {
                if (salesByYear.hasOwnProperty(data.year)) {
                    salesByYear[data.year] = data.sales;
                }
            });

            // Prepare the data for the chart
            const years = yearsRange;
            const sales = years.map(year => salesByYear[year]);

            const ctx = document.getElementById('linearChart').getContext('2d');

            // Destroy the previous chart instance if it exists
            if (currentChart) {
                currentChart.destroy();
            }

            // Create a new chart instance
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years, // Ensure years are in the correct order
                    datasets: [{
                        label: `Satış Miktar: ${selectedName}`,
                        data: sales,
                        borderColor: 'rgba(139, 0, 0, 1)',
                        backgroundColor: 'rgba(139, 0, 0, 1)',
                        borderWidth: 2,
                    }],
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Yıl',
                            },
                            // Ensures years are displayed in the correct order
                            ticks: {
                                autoSkip: false,
                                maxRotation: 0,
                                minRotation: 0,
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Satış Miktar',
                            },
                            beginAtZero: true, // Ensures y-axis starts from 0
                        },
                    },
                },
            });
        }

        populateDropdown();
    </script>


<script>
    async function fetchSituationData() {
        const response = await fetch('/situationData');
        const data = await response.json();
        return data;
    }

    function renderDoughnutChart(data) {
        // Sort data in descending order based on market share
        data.sort((a, b) => b.market_share - a.market_share);

        const ctx = document.getElementById('doughnutChart').getContext('2d');
        const labels = data.map(item => item.company_name);
        const values = data.map(item => item.market_share);
        const colors = [
            'rgba(139, 0, 0, 0.8)',    // Dark Red
            'rgba(0, 0, 139, 0.8)',    // Dark Blue
            'rgba(184, 134, 11, 0.8)', // Dark Goldenrod
            'rgba(0, 100, 0, 0.8)',    // Dark Green
            'rgba(72, 61, 139, 0.8)',  // Dark Slate Blue
            'rgba(139, 69, 19, 0.8)',  // Saddle Brown
            'rgba(128, 0, 128, 0.8)',  // Purple
            'rgba(0, 128, 128, 0.8)',  // Teal
            'rgba(255, 69, 0, 0.8)'    // Orange Red
        ];
        const borderColors = [
            'rgba(139, 0, 0, 1)',
            'rgba(0, 0, 139, 1)',
            'rgba(184, 134, 11, 1)',
            'rgba(0, 100, 0, 1)',
            'rgba(72, 61, 139, 1)',
            'rgba(139, 69, 19, 1)',
            'rgba(128, 0, 128, 1)',
            'rgba(0, 128, 128, 1)',
            'rgba(255, 69, 0, 1)'
        ];

        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels.map((label, index) => `${index + 1}. ${label}`),
                datasets: [{
                    data: values,
                    backgroundColor: colors.slice(0, data.length),
                    borderColor: borderColors.slice(0, data.length),
                    borderWidth: 1.5,
                    hoverOffset: 20, // Add separation effect on hover/touch
                    spacing : 5
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'left', // Position legend on the left
                        align: 'start', // Align legend items vertically
                    },
                    title: {
                        display: true,
                        text: 'Şirketlere Göre Pazar Payı',
                        position: 'top',
                        align: 'end', // Align title to the right
                        padding: {
                            top: 10,
                            bottom: 30
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label.split('. ')[1];
                                return `${label}: ${context.raw}%`;
                            }
                        }
                    },
                    datalabels: {
                        color: '#fff',
                        anchor: 'center',
                        align: 'center',
                        offset: 0,
                        formatter: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            plugins: [ChartDataLabels]
        });
    }

    fetchSituationData().then(data => renderDoughnutChart(data));
</script>

    <script>
        let currentChart1 = null; // Variable to store the current chart instance

        async function populateDropdown1() {
    const response = await fetch('/getEvNameData');
    const names = await response.json(); // This will be an array of names
    const dropdown = document.getElementById('nameDropdown1'); // Corrected ID

    // Clear existing options before adding new ones
    dropdown.innerHTML = '';

    // Add the default "Bir model seçiniz" option
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = 'Bir model seçiniz';
    defaultOption.disabled = true;
    defaultOption.selected = true;
    dropdown.appendChild(defaultOption);

    // Add other options
    names.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        dropdown.appendChild(option);
    });
}


        async function fetchAndRenderChart1() {
            const selectedName1 = document.getElementById('nameDropdown1').value; // Corrected ID
            if (!selectedName1) return;

            const response = await fetch(`/getEvData?name=${encodeURIComponent(selectedName1)}`); // Corrected variable name
            const evData = await response.json(); // Corrected variable name

            // Initialize a year range (2019 to 2023)
            const yearsRange = [2019, 2020, 2021, 2022, 2023];

            // Prepare an object to store sales data by year
            const salesByYear = {}; // Corrected variable name
            yearsRange.forEach(year => {
                salesByYear[year] = 0; // Initialize with 0 for each year
            });

            // Fill the salesByYear object with the actual sales data
            evData.forEach(data => {  // Corrected variable name
                if (salesByYear.hasOwnProperty(data.year)) {
                    salesByYear[data.year] = data.sales;
                }
            });

            // Prepare the data for the chart
            const years = yearsRange;
            const sales = years.map(year => salesByYear[year]);

            const ctx = document.getElementById('linearChart1').getContext('2d');

            // Destroy the previous chart instance if it exists
            if (currentChart1) {
                currentChart1.destroy();
            }

            // Create a new chart instance
            currentChart1 = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years, // Ensure years are in the correct order
                    datasets: [{
                        label: `Satış Miktar ${selectedName1}`, // Corrected variable name
                        data: sales,
                        borderColor: 'rgba(0, 0, 139, 1)',
                        backgroundColor: 'rgba(0, 0, 139, 1)',
                        borderWidth: 2,
                    }],
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Yıl',
                            },
                            // Ensures years are displayed in the correct order
                            ticks: {
                                autoSkip: false,
                                maxRotation: 0,
                                minRotation: 0,
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Satış Miktar',
                            },
                            beginAtZero: true, // Ensures y-axis starts from 0
                        },
                    },
                },
            });
        }

        populateDropdown1(); // Initialize the dropdown when the page loads
    </script>


</body>

</html>