<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trends and Situation</title>
    <link rel="stylesheet" href="trends.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            background: url('pic.png') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            padding: 20px;
        }

        .back-button {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            color: #fff;
            background: #005ea8;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            font-size: 18px;
            /* Increase font size */
            margin-bottom: 20px;
            /* Add margin to separate the button from the chart box */
        }

        .back-button:hover {
            background: #003f74;
        }

        .back-button .material-icons {
            vertical-align: middle;
            margin-right: 5px;
        }


        .trend-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: stretch;
            /* Ensure all items are the same height */
            max-width: 100%;
            margin-left: 0 auto;
            /* Center align horizontally */
        }

        .trend-section {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            /* Ensure content is spaced evenly */
        }

        .trend-section h2 {
            color: #005ea8;
        }

        .chart-box {
            width: calc(100% - 40px);
            /* Match the width of the trend containers */
            max-width: 400px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin: 20px 0 0 0;
            /* Align to the left and add top margin */
        }

        .chart-info {
            margin-top: 20px;
            font-size: 16px;
            color: #333;
        }
    </style>
</head>

<body>
    <a href="dashboard.html" class="back-button">
        <span class="material-icons">arrow_back</span>
        <span>Back to Dashboard</span>
    </a>
    <div class="trend-container">
        <div class="trend-section">
            <h2>1. Global Automotive Market Trends</h2>
            <p><strong>Electric Vehicle (EV) Adoption:</strong> A substantial shift towards electric vehicles is
                occurring in the global automotive market. 
                Over 35% of new vehicle sales in China during 2023 were
                electric, and this upward trend is projected to continue, impacting the industry worldwide.</p>
        </div>
        <div class="trend-section">
            <h2>2. Competitive Landscape</h2>
            <p><strong>Japanese Automaker Consolidation:</strong> Honda and Nissan are in discussions about a potential
                merger to address competitive pressures from Tesla and Chinese automakers. Such a merger would position
                them as the world's third-largest auto group by vehicle sales, potentially intensifying competition for
                Volkswagen.</p>
        </div>
        <div class="trend-section">
            <h2>3. Market Challenges and Opportunities</h2>
            <p><strong>Consumer Preferences:</strong> There is a growing consumer shift towards compact cars and
                electric vehicles, driven by affordability concerns and environmental considerations. This trend
                presents opportunities for manufacturers to diversify their product lines to meet evolving consumer
                demands.</p>
        </div>
    </div>
    <div class="chart-box">
        <canvas id="doughnutChart" width="400" height="400"></canvas>
        <div class="chart-info">
            <p>This chart represents the market share of different companies. Each segment shows the percentage of the
                market held by a specific company.</p>
        </div>
    </div>
    <script>
        async function fetchSituationData() {
            const response = await fetch('/situationData');
            const data = await response.json();
            return data;
        }

        function renderDoughnutChart(data) {
            // Sort data in descending order based on market share
            data.sort((a, b) => b.market_share - a.market_share);

            const ctx = document.getElementById('doughnutChart').getContext('2d');
            const labels = data.map(item => item.company_name);
            const values = data.map(item => item.market_share);
            const colors = [
                'rgba(139, 0, 0, 0.8)',    // Dark Red
                'rgba(0, 0, 139, 0.8)',    // Dark Blue
                'rgba(184, 134, 11, 0.8)', // Dark Goldenrod
                'rgba(0, 100, 0, 0.8)',    // Dark Green
                'rgba(72, 61, 139, 0.8)',  // Dark Slate Blue
                'rgba(139, 69, 19, 0.8)',  // Saddle Brown
                'rgba(128, 0, 128, 0.8)',  // Purple
                'rgba(0, 128, 128, 0.8)',  // Teal
                'rgba(255, 69, 0, 0.8)'    // Orange Red
            ];
            const borderColors = [
                'rgba(139, 0, 0, 1)',
                'rgba(0, 0, 139, 1)',
                'rgba(184, 134, 11, 1)',
                'rgba(0, 100, 0, 1)',
                'rgba(72, 61, 139, 1)',
                'rgba(139, 69, 19, 1)',
                'rgba(128, 0, 128, 1)',
                'rgba(0, 128, 128, 1)',
                'rgba(255, 69, 0, 1)'
            ];

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels.map((label, index) => `${index + 1}. ${label}`),
                    datasets: [{
                        data: values,
                        backgroundColor: colors.slice(0, data.length),
                        borderColor: borderColors.slice(0, data.length),
                        borderWidth: 2,
                        hoverOffset: 25 // Add separation effect on hover/touch
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'left', // Position legend on the left
                            align: 'start', // Align legend items vertically
                        },
                        title: {
                            display: true,
                            text: 'Market Share by Company',
                            position: 'top',
                            align: 'end', // Align title to the right
                            padding: {
                                top: 10,
                                bottom: 30
                            }
                        }
                    }
                }
            });
        }

        fetchSituationData().then(data => renderDoughnutChart(data));
    </script>
</body>

</html>